<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BTC Hourly Movement Analysis</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
body {background: linear-gradient(135deg, #0a0e17 0%, #1a1f2d 100%); color: #e0e0e0; padding: 20px; min-height: 100vh;}
.container {max-width: 1200px; margin:0 auto;}
header {text-align:center; margin-bottom:30px; padding:30px; background: rgba(26,31,45,0.8); border-radius:15px; box-shadow:0 8px 32px rgba(0,0,0,0.4); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.1);}
h1 {font-size:2.8rem; margin-bottom:10px; background: linear-gradient(90deg,#f7931a 0%,#ffcc80 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; text-shadow:0 0 15px rgba(247,147,26,0.4);}
.subtitle {font-size:1.2rem; color:#aaa; margin-bottom:20px; max-width:600px; margin:0 auto; line-height:1.6;}
.controls {display:flex; justify-content:center; gap:20px; margin-bottom:40px; flex-wrap:wrap;}
select, button {padding:10px 16px; border-radius:8px; border:none; font-size:1rem; cursor:pointer;}
button {background: linear-gradient(135deg, #f7931a 0%, #e2520c 100%); color:white; font-weight:bold; transition:0.3s;}
button:hover {transform: translateY(-2px);}
.summary-cards {display:flex; gap:25px; margin-bottom:40px; flex-wrap:wrap;}
.card {flex:1; min-width:250px; background: rgba(26,31,45,0.8); padding:25px; border-radius:15px; text-align:center; backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.1);}
.card h3 {color:#ffcc80; margin-bottom:15px; font-size:1.3rem;}
.card p {font-size:2rem; font-weight:bold; color:#f7931a;}
.chart-container {background: rgba(26,31,45,0.8); padding:25px; border-radius:15px; margin-bottom:40px; box-shadow:0 8px 24px rgba(0,0,0,0.3); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.1);}
.data-table {width:100%; border-collapse: collapse; margin-top:20px;}
.data-table th, .data-table td {padding:12px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.1);}
.data-table th {color:#ffcc80; font-weight:600;}
.positive {color:#4cd964;}
.negative {color:#ff3b30;}
.error {text-align:center; padding:20px; color:#ff6b6b; background: rgba(255,107,107,0.1); border-radius:10px; margin-bottom:25px; display:none; border-left:4px solid #ff6b6b;}
.loading {text-align:center; padding:50px; font-size:1.3rem; color:#f7931a; display:none;}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Bitcoin Hourly Movement Analysis</h1>
<p class="subtitle">Discover BTC price changes between two selected hours (UTC)</p>
</header>

<div class="error" id="errorMessage"></div>

<div class="controls">
    <select id="hour1">
        <option value="">Hour 1</option>
        </select>
        
        <select id="hour2">
        <option value="">Hour 2</option>
        </select>

<button id="analyzeButton">üìä Analyze</button>
</div>

<div id="loading" class="loading">Loading data and performing analysis... ‚è≥</div>

<div id="results" style="display:none;">
<div class="summary-cards">
<div class="card">
<h3>üìà Total Change</h3>
<p id="totalChange">0%</p>
</div>
<div class="card">
<h3>üìâ Days Drop</h3>
<p id="daysDrop">0</p>
</div>
<div class="card">
<h3>üöÄ Days Rise</h3>
<p id="daysRise">0</p>
</div>
</div>

<div class="chart-container">
<canvas id="priceChart"></canvas>
</div>

<div class="result-box">
<h3>Daily Data</h3>
<table class="data-table">
<thead>
<tr>
<th>Date</th>
<th id="headerHour1">Price Hour 1</th>
<th id="headerHour2">Price Hour 2</th>
<th>Change</th>
</tr>
</thead>
<tbody id="dataTable"></tbody>
</table>
</div>
</div>
</div>

<script>
    const hour1Select = document.getElementById('hour1');
    const hour2Select = document.getElementById('hour2');
    
    for (let h = 0; h < 24; h++) {
        const option1 = document.createElement('option');
        option1.value = h;
        option1.textContent = `${h}:00`;
        hour1Select.appendChild(option1);
    
        const option2 = document.createElement('option');
        option2.value = h;
        option2.textContent = `${h}:00`;
        hour2Select.appendChild(option2);
    }
    </script>

<script>
document.addEventListener('DOMContentLoaded', function(){
const analyzeButton = document.getElementById('analyzeButton');
const loadingElement = document.getElementById('loading');
const resultsElement = document.getElementById('results');
const errorMessage = document.getElementById('errorMessage');
const hour1Select = document.getElementById('hour1');
const hour2Select = document.getElementById('hour2');
let priceChart = null;

function showError(msg){
    errorMessage.textContent = msg;
    errorMessage.style.display='block';
    setTimeout(()=>errorMessage.style.display='none',5000);
}

function formatCurrency(val){ return '$'+Number(val).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }
function formatPercentage(val){ return (val>0?'+':'')+val.toFixed(2)+'%'; }
function formatDate(date){ return date.toISOString().split('T')[0]; }

async function loadBTCData(){
    loadingElement.style.display='block';
    resultsElement.style.display='none';
    try{
        const res = await fetch('./btc_klines.json');
        if(!res.ok) throw new Error('Failed to fetch JSON');
        const klines = await res.json();
        return klines;
    }catch(err){ showError('Failed to load BTC data: '+err.message); loadingElement.style.display='none'; throw err; }
}

async function generateBTCComparison(){
    const hour1 = parseInt(hour1Select.value);
    const hour2 = parseInt(hour2Select.value);
    if(isNaN(hour1) || isNaN(hour2)){ showError('Select both hours'); return; }


    document.getElementById('headerHour1').textContent = `Price Hour ${hour1}:00`;
    document.getElementById('headerHour2').textContent = `Price Hour ${hour2}:00`;

    const klines = await loadBTCData();

    const daysMap = {};
    for(const k of klines){
    const ts = new Date(k[0]);
    ts.setHours(ts.getHours() + 3);

    const date = ts.toISOString().split('T')[0];
    if(!daysMap[date]) daysMap[date] = {};
    const hour = ts.getUTCHours();
    daysMap[date][hour] = parseFloat(k[1]); 
}

    const data=[];
    const sortedDates = Object.keys(daysMap).sort();
    for(let i=0;i<sortedDates.length;i++){
        const date = sortedDates[i];
        const dayHours = daysMap[date];
        let price1 = dayHours[hour1];
        let price2;

        if(hour2>=hour1){
            price2 = dayHours[hour2];
        }else{
            const nextDate = sortedDates[i+1];
            if(!nextDate) continue;
            price2 = daysMap[nextDate][hour2];
        }

        if(price1!=null && price2!=null){
            data.push({date:new Date(date), price1, price2, change:((price2-price1)/price1)*100});
        }
    }

    fillTable(data);
    createChart(data, hour1, hour2);
    loadingElement.style.display='none';
    resultsElement.style.display='block';
}

function fillTable(data){
    const tbody = document.getElementById('dataTable');
    tbody.innerHTML='';
    let totalChange=0, daysDrop=0, daysRise=0;
    data.forEach(item=>{
        totalChange+=item.change;
        if(item.change<0) daysDrop++; else daysRise++;
        const row=document.createElement('tr');
        row.innerHTML=`
            <td>${formatDate(item.date)}</td>
            <td>${formatCurrency(item.price1)}</td>
            <td>${formatCurrency(item.price2)}</td>
            <td class="${item.change>=0?'positive':'negative'}">${formatPercentage(item.change)}</td>
        `;
        tbody.appendChild(row);
    });
    document.getElementById('totalChange').textContent=formatPercentage(totalChange);
    document.getElementById('daysDrop').textContent=daysDrop;
    document.getElementById('daysRise').textContent=daysRise;
}

function createChart(data, hour1, hour2){
    const ctx=document.getElementById('priceChart').getContext('2d');
    const labels=data.map(d=>formatDate(d.date));
    const changes=data.map(d=>d.change);
    if(priceChart) priceChart.destroy();
    priceChart=new Chart(ctx,{
        type:'line',
        data:{labels, datasets:[{label:`Change from ${hour1}:00 to ${hour2}:00`, data:changes, backgroundColor:'rgba(247,147,26,0.2)', borderColor:'rgba(247,147,26,1)', borderWidth:2, pointRadius:2, fill:true, tension:0.3}]},
        options:{responsive:true, plugins:{legend:{labels:{color:'#e0e0e0'}}, tooltip:{backgroundColor:'rgba(26,31,45,0.9)', titleColor:'#ffcc80', bodyColor:'#e0e0e0'}}}
    });
}

analyzeButton.addEventListener('click', generateBTCComparison);
});
</script>
</body>
</html>
